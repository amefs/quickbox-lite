!function(i){var n=-1,e={onVisible:function(i){var n=e.isSupported();if(!n||!e.hidden())return i(),n;var t=e.change(function(n,d){e.hidden()||(e.unbind(t),i())});return t},change:function(i){if(!e.isSupported())return!1;var t=n+=1;return e._callbacks[t]=i,e._listen(),t},unbind:function(i){delete e._callbacks[i]},afterPrerendering:function(i){var n=e.isSupported();if(!n||"prerender"!=e.state())return i(),n;var t=e.change(function(n,d){"prerender"!=d&&(e.unbind(t),i())});return t},hidden:function(){return!(!e._doc.hidden&&!e._doc.webkitHidden)},state:function(){return e._doc.visibilityState||e._doc.webkitVisibilityState||"visible"},isSupported:function(){return void 0!==e._doc.hidden||void 0!==e._doc.webkitHidden},_doc:document||{},_callbacks:{},_change:function(i){var n=e.state();for(var t in e._callbacks)e._callbacks[t].call(e._doc,i,n)},_listen:function(){if(!e._init){var i="visibilitychange";e._doc.webkitVisibilityState&&(i="webkit"+i);var n=function(){e._change.apply(e,arguments)};e._doc.addEventListener?e._doc.addEventListener(i,n):e._doc.attachEvent(i,n),e._init=!0}}};"undefined"!=typeof module&&module.exports?module.exports=e:i.Visibility=e}(this);
