Math.randomString=function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},String.prototype.getCss=function(){for(var t={},e=this.valueOf().split(";"),i=0;i<e.length;i++)if(e[i]=$.trim(e[i]),e[i]){var n=e[i].split(":");t[$.trim(n[0])]=$.trim(n[1])}return t},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.toCamel=function(){return this.replace(/(\-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})},String.prototype.toDash=function(){return this.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})},String.prototype.toUnderscore=function(){return this.replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()})},Number.prototype.isBetween=function(t,e,i){if(i){if(this.valueOf()<=e&&this.valueOf()>=t)return!0}else if(this.valueOf()<e&&this.valueOf()>t)return!0;return!1},$.fn.insertAt=function(t,e){var i=e;if("string"==typeof e&&(i=$(e)),0==(t=Math.min(i.children().length,t)))return i.prepend(this),this;var n=this.data("index");t&&!isNaN(t)||(t=i.children().length-1),this.attr("data-index",t);var a=i.children().eq(t-1);return a.length?a.after(this):i.append(this),i.children().each(function(e,i){var a=$(i);n<t&&e>n&&e<=t?a.attr("data-index",parseInt(a.data("data-index"),10)-1):n>=t&&e>t&&e<=n&&a.attr("data-index",parseInt(a.attr("data-index"),10)+1)}),this},$.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",!1)},$.fn.enableSelection=function(){return this.removeAttr("unselectable").css("user-select","initial").off("selectstart")},$(function(){var STORAGE_PREFIX="lobipanel_",StorageLocal=function(){this.saveChildPositions=function(t,e){void 0!==e&&localStorage.setItem(STORAGE_PREFIX+"parent_"+t,JSON.stringify(e))},this.savePanelParams=function(t,e){localStorage.setItem(STORAGE_PREFIX+t,JSON.stringify(e))},this.getAllPanelPositions=function(){var t=[];for(var e in localStorage)if(0===e.indexOf(STORAGE_PREFIX+"parent_")){var i=e.replace(STORAGE_PREFIX+"parent_","");$(".lobipanel-parent-sortable[data-inner-id="+i+"]").length&&(t[i]=JSON.parse(localStorage[e]))}return t},this.getPanelStorage=function(t){var e=localStorage.getItem(STORAGE_PREFIX+t);return JSON.parse(e||null)||{}}},LobiPanel=function(t,e){var i=this;this.hasRandomId=!1,this.storage=null,this.$el=t,i.$el.data("inner-id")||(i.hasRandomId=!0,i.$el.attr("data-inner-id",Math.randomString(10))),this.innerId=i.$el.data("inner-id"),this.$options=i._processInput(e),i.$heading=this.$el.find(">.panel-heading"),i.$body=this.$el.find(">.panel-body"),i._init(),i.$el.css("display","none"),i._applyState(i.$options.state,i.$options.stateParams),i.$el.css("display","block")};LobiPanel.prototype={_processInput:function(t){t||(t={}),this.hasRandomId||(this.storageObject||(this.storageObject=new StorageLocal),this.storage=this.storageObject.getPanelStorage(this.innerId));var e=this._getOptionsFromAttributes();t=$.extend({},$.fn.lobiPanel.DEFAULTS,this.storage,t,e);for(var i=["unpin","reload","expand","minimize","close","editTitle"],n=0;n<i.length;n++){var a=i[n];"object"==typeof t[a]&&(t[a]=$.extend({},$.fn.lobiPanel.DEFAULTS[a],t[a],e[a]))}return t},_init:function(){var t=this;t.$el.addClass("lobipanel"),t.$heading.append(t._generateControls());var e=t.$el.parent();t._appendInnerIdToParent(e,t.innerId),t._enableSorting(),t._onToggleIconsBtnClick(),t._enableResponsiveness(),t._setBodyHeight(),t.$options.autoload&&t.load();var i="calc(100% - "+t.$heading.find(".dropdown-menu").children().length*t.$heading.find(".dropdown-menu li").first().outerWidth()+"px)";t.$heading.find(".panel-title").css("max-width",i),t.getParam("panelTitle")&&t.$heading.find(".panel-title").html(t.getParam("panelTitle"));var n=t.getParam("panelStyle");n&&t.applyStyle(n.bg,n.text),t._triggerEvent("init")},isPanelInit:function(){return this.$el.hasClass("lobipanel")&&this.$el.data("inner-id")},isPinned:function(){return!this.$el.hasClass("panel-unpin")},pin:function(){var t=this;t.disableResize(),t.disableDrag(),t._offPanelClick(),t.$el.removeClass("panel-unpin").attr("old-style",t.$el.attr("style")).css("position","relative");var e=["position","z-index","left","top","width","height"];for(var i in e)t.$el.css(e[i],"");return t.$body.css({width:"",height:""}),t._setBodyHeight(),t._insertInParent(),t._enableSorting(),t},unpin:function(){var t=this;if(t.$el.hasClass("panel-collapsed"))return t;if(t._disableSorting(),t.$el.attr("old-style"))t.$el.attr("style",t.$el.attr("old-style"));else{var e=t.$el.width(),i=t.$el.height(),n=Math.max(0,($(window).width()-t.$el.outerWidth())/2),a=Math.max(0,$(document).scrollTop()+($(window).height()-t.$el.outerHeight())/2);t.$el.css({left:n,top:a,width:e,height:i})}var o=t._getMaxZIndex();t.$el.css("z-index",o["z-index"]+1),t._onPanelClick(),t.$el.addClass("panel-unpin"),$("body").append(t.$el);var l=t._getAvailableWidth(t.$el.width()),s=t._getAvailableHeight(t.$el.height());t.$el.css({position:"absolute",width:l,height:s});var r=t._calculateBodyHeight(s),d=t._calculateBodyWidth(l);return t.$body.css({width:d,height:r}),t.$options.draggable&&t.enableDrag(),"none"!==t.$options.resize&&t.enableResize(),t},togglePin:function(){return this.isPinned()?this.unpin():this.pin(),this},isMinimized:function(){return this.$el.hasClass("panel-minimized")||this.$el.hasClass("panel-collapsed")},minimize:function(){var t=this;if(t._triggerEvent("beforeMinimize"),t.isMinimized())return t;if(t.isPinned())t.$body.slideUp(),t.$el.find(".panel-footer").slideUp(),t.$el.addClass("panel-collapsed"),t._saveState("collapsed"),t._changeClassOfControl(t.$heading.find('[data-func="minimize"]'));else{t.disableTooltips();var e,i,n=t._getFooterForMinimizedPanels(),a=n.find(">*");if(i=n.offset().top,0===a.length)e=n.offset().left;else{var o=$(a[a.length-1]);e=o.offset().left+o.width()}t.$el.hasClass("panel-expanded")||t.$el.attr("old-style",t.$el.attr("style")),t.$el.animate({left:e,top:i,width:200,height:n.height()},100,function(){t.$el.hasClass("panel-expanded")&&(t.$el.removeClass("panel-expanded"),t.$el.find(".panel-heading [data-func=expand] ."+LobiPanel.PRIVATE_OPTIONS.iconClass).removeClass(t.$options.expand.icon2).addClass(t.$options.expand.icon)),t.$el.addClass("panel-minimized"),t.$el.removeAttr("style"),t.disableDrag(),t.disableResize(),t._expandOnHeaderClick(),n.append(t.$el),$("body").addClass("lobipanel-minimized");var e="calc(100% - "+t.$heading.find(".dropdown-menu li>a:visible").length*t.$heading.find(".dropdown-menu li>a:visible").first().outerWidth()+"px)";t.$heading.find(".panel-title").css("max-width",e),t._saveState("minimized"),t._triggerEvent("onMinimize")})}return t},maximize:function(){var t=this;if(t._triggerEvent("beforeMaximize"),!t.isMinimized())return t;if(t.isPinned())t.$body.slideDown(),t.$el.find(".panel-footer").slideDown(),t.$el.removeClass("panel-collapsed"),t._saveState("pinned"),t._changeClassOfControl(t.$heading.find('[data-func="minimize"]'));else{t.enableTooltips();var e=t.$el.attr("old-style").getCss();t.$el.css({position:e.position||"fixed","z-index":e["z-index"],left:t.$el.offset().left,top:t.$el.offset().top,width:t.$el.width(),height:t.$el.height()}),$("body").append(t.$el),delete e.position,delete e["z-index"],t.$el.animate(e,100,function(){t.$el.css("position",""),t.$el.removeClass("panel-minimized"),t.$el.removeAttr("old-style"),t.$options.draggable&&t.enableDrag(),t.enableResize(),t._removeExpandOnHeaderClick();var e=t._getFooterForMinimizedPanels();0===e.children().length&&e.remove(),$("body").removeClass("lobipanel-minimized").addClass("lobipanel-minimized");var i="calc(100% - "+t.$heading.find(".dropdown-menu li").length*t.$heading.find(".dropdown-menu li").first().outerWidth()+"px)";t.$heading.find(".panel-title").css("max-width",i),t._updateUnpinnedState(),t._triggerEvent("onMaximize")})}return t},toggleMinimize:function(){return this.isMinimized()?this.maximize():this.minimize(),this},isOnFullScreen:function(){return this.$el.hasClass("panel-expanded")},toFullScreen:function(){var t=this;if(t._triggerEvent("beforeFullScreen"),t.$el.hasClass("panel-collapsed"))return t;t.$el.attr("data-index",t.$el.index()),t._changeClassOfControl(t.$heading.find('[data-func="expand"]')),t.$el.css("position","fixed");var e=t._getMaxZIndex();if(t.isPinned()||t.isMinimized()){t.enableTooltips(),t.$el.css({"z-index":e["z-index"]+1,left:t.$el.offset().left,top:t.$el.offset().top-$(window).scrollTop(),width:t.$el.width(),height:t.$el.height()}),$("body").append(t.$el);var i=t._getFooterForMinimizedPanels();0===i.children().length&&i.remove()}else t.$body.css({width:"",height:""}),t._setBodyHeight();t.isMinimized()?(t.$el.removeClass("panel-minimized"),t._removeExpandOnHeaderClick()):(t.$el.attr("old-style",t.$el.attr("style")),t.disableResize());var n=$("."+LobiPanel.PRIVATE_OPTIONS.toolbarClass).outerHeight()||0;return t.$el.animate({width:$(window).width(),height:$(window).height()-n,left:0,top:0},t.$options.expandAnimation,function(){t.$el.css({width:"",height:"",right:0,bottom:n}),t.$el.addClass("panel-expanded"),$("body").css("overflow","hidden"),t.$body.css({width:t._calculateBodyWidth(t.$el.width()),height:t._calculateBodyHeight(t.$el.height())}),t.disableDrag(),t.isPinned()&&t._disableSorting(),t._saveState("fullscreen"),t._triggerEvent("onFullScreen")}),t},toSmallSize:function(){var t=this;t._triggerEvent("beforeSmallSize"),t._changeClassOfControl(t.$heading.find('[data-func="expand"]'));var e=t.$el.attr("old-style").getCss(),i=["position","z-index","left","top","width","height"];return t.$el.animate({position:"absolute",left:e.left,top:e.top,width:e.width,height:e.height,right:e.right,bottom:e.bottom},t.$options.collapseAnimation,function(){if(t.$el.removeAttr("old-style"),t.$el.hasClass("panel-unpin"))t.$options.draggable&&t.enableDrag(),t.enableResize();else{for(var e in i)t.$el.css(i[e],"");t._insertInParent(),t._enableSorting()}t.$el.removeClass("panel-expanded"),$("body").css("overflow","auto");var n="",a="";t.isPinned()?"auto"!==t.$options.bodyHeight&&(a=t.$options.bodyHeight):(n=t._calculateBodyWidth(t.getWidth()),a=t._calculateBodyHeight(t.getHeight())),t.isPinned()?t._saveState("pinned"):t._updateUnpinnedState(),t.$body.css({width:n,height:a}),t._triggerEvent("onSmallSize")}),t},toggleSize:function(){return this.isOnFullScreen()?this.toSmallSize():this.toFullScreen(),this},close:function(t){var e=this;t=void 0===t?100:t;return e._triggerEvent("beforeClose"),e.$el.hide(t,function(){e.isOnFullScreen()&&$("body").css("overflow","auto"),e._triggerEvent("onClose"),e.$el.remove();var t=e._getFooterForMinimizedPanels();0===t.children().length&&t.remove()}),e},setPosition:function(t,e,i){i=void 0===i?100:i;return this.isPinned()?this:(this.$el.animate({left:t,top:e},i),this)},setWidth:function(t,e){e=void 0===e?100:e;if(this.isPinned())return this;var i=this._calculateBodyWidth(t);return this.$el.animate({width:t},e),this.$body.animate({width:i},e),this},setHeight:function(t,e){e=void 0===e?100:e;if(this.isPinned())return this;var i=this._calculateBodyHeight(t);return this.$el.animate({height:t},e),this.$body.animate({height:i},e),this},setSize:function(t,e,i){i=void 0===i?100:i;if(this.isPinned())return this;var n=this._calculateBodyHeight(e),a=this._calculateBodyWidth(t);return this.$el.animate({height:e,width:t},i),this.$body.animate({height:n,width:a},i),this},getPosition:function(){var t=this.$el.offset();return{x:t.left,y:t.top}},getWidth:function(){return this.$el.width()},getHeight:function(){return this.$el.height()},bringToFront:function(){this._triggerEvent("beforeToFront");var t=this._getMaxZIndex();return t.id===this.$el.data("inner-id")?this:(this.$el.css("z-index",t["z-index"]+1),this._triggerEvent("onToFront"),this)},enableDrag:function(){var t=this;return t.$el.draggable({handle:".panel-heading",containment:t.$options.constrain,start:function(){t.$el.css("position","absolute")},stop:function(){t.$el.css("position",""),t._updateUnpinnedState()}}),t},disableDrag:function(){return this.$el.hasClass("ui-draggable")&&this.$el.draggable("destroy"),this},enableResize:function(){var t=this,e=!1;return"vertical"===t.$options.resize?e="n, s":"horizontal"===t.$options.resize?e="e, w":"both"===t.$options.resize&&(e="all"),e?(t.$el.resizable({minWidth:t.$options.minWidth,maxWidth:t.$options.maxWidth,minHeight:t.$options.minHeight,maxHeight:t.$options.maxHeight,handles:e,start:function(){t.$el.disableSelection(),t._triggerEvent("resizeStart")},stop:function(){t.$el.enableSelection(),t._triggerEvent("resizeStop")},resize:function(){var e=t._calculateBodyHeight(t.$el.height()),i=t._calculateBodyWidth(t.$el.width());t.$body.css({width:i,height:e}),t._updateUnpinnedState(),t._triggerEvent("onResize")}}),t):t},disableResize:function(){return this.$el.hasClass("ui-resizable")&&this.$el.resizable("destroy"),this},startLoading:function(){var t=this._generateWindow8Spinner();this.$el.append(t);return t.find(".spinner").css("margin-top",50),this},stopLoading:function(){return this.$el.find(".spinner-wrapper").remove(),this},setLoadUrl:function(t){return this.$options.loadUrl=t,this},load:function(t){var e=this;"string"==typeof(t=t||{})&&(t={url:t});var i=t.url||e.$options.loadUrl,n=t.data||{},a=t.callback||null;return i?(e._triggerEvent("beforeLoad"),e.startLoading(),e.$body.load(i,n,function(t,i,n){a&&"function"==typeof a&&e.callback(t,i,n),e.stopLoading(),e._triggerEvent("loaded",t,i,n)}),e):e},destroy:function(){return this.disableDrag(),this.disableResize(),this.$options.sortable=!1,this._enableSorting(),this._removeInnerIdFromParent(this.innerId),this.$el.removeClass("lobipanel").removeAttr("data-inner-id").removeAttr("data-index").removeData("lobiPanel"),this.$heading.find(".dropdown").remove(),this.$el},startTitleEditing:function(){var t=this,e=t.$heading.find(".panel-title").text().trim(),i=$('<input value="'+e+'"/>');return i.on("keydown",function(e){13===e.which?t.finishTitleEditing():27===e.which&&t.cancelTitleEditing()}),t.$heading.find(".panel-title").data("old-title",e).html("").append(i),i[0].focus(),i[0].select(),t._changeClassOfControl(t.$heading.find('[data-func="editTitle"]')),t},isTitleEditing:function(){return this.$heading.find(".panel-title input").length>0},cancelTitleEditing:function(){var t=this.$heading.find(".panel-title");return t.html(t.data("old-title")).find("input").remove(),this._changeClassOfControl(this.$heading.find('[data-func="editTitle"]')),this},finishTitleEditing:function(){var t=this.$heading.find("input");return!1===this._triggerEvent("beforeTitleChange",t.val())?this:(this.saveParam("panelTitle",t.val()),this.$heading.find(".panel-title").html(t.val()),t.remove(),this._changeClassOfControl(this.$heading.find('[data-func="editTitle"]')),this._triggerEvent("onTitleChange",t.val()),this)},enableTooltips:function(){if($(window).width()<768)return this;var t=this.$heading.find(".dropdown-menu>li>a");return t.each(function(t,e){var i=$(e);i.attr("data-toggle","tooltip").attr("data-title",i.data("tooltip")).attr("data-placement","bottom")}),t.each(function(t,e){$(e).tooltip({container:"body",template:'<div class="tooltip lobipanel-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})}),this},disableTooltips:function(){return this.$heading.find(".dropdown-menu>li>a").each(function(t,e){$(e).data("bs.tooltip")&&$(e).tooltip("destroy")}),this},_generateControls:function(){var t=this._generateDropdown(),e=t.find(".dropdown-menu");return!1!==this.$options.editTitle&&e.append(this._generateEditTitle()),!1!==this.$options.unpin&&e.append(this._generateUnpin()),!1!==this.$options.reload&&e.append(this._generateReload()),!1!==this.$options.minimize&&e.append(this._generateMinimize()),!1!==this.$options.expand&&e.append(this._generateExpand()),!1!==this.$options.changeStyle&&e.append(this._generateChangeStyle()),!1!==this.$options.close&&e.append(this._generateClose()),e.find(">li>a").on("click",function(t){t.preventDefault(),t.stopPropagation()}),t},_generateDropdown:function(){return $('<div class="dropdown"></div>').append('<ul class="dropdown-menu dropdown-menu-right"></ul>').append('<div class="dropdown-toggle" data-toggle="dropdown"><span class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+this.$options.toggleIcon+'"></div>')},_generateEditTitle:function(){var t=this.$options.editTitle,e=$('<a data-func="editTitle"></a>');return e.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(e.append('<span class="control-title">'+t.tooltip+"</span>"),e.attr("data-tooltip",t.tooltip)),this._attachEditTitleClickListener(e),$("<li></li>").append(e)},_attachEditTitleClickListener:function(t){var e=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(i){i.stopPropagation(),e.hideTooltip(t),e.isTitleEditing()?e.finishTitleEditing():e.startTitleEditing()})},hideTooltip:function(t){return t.data("bs.tooltip")&&t.tooltip("hide"),this},_generateUnpin:function(){var t=this.$options.unpin,e=$('<a data-func="unpin"></a>');return e.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(e.append('<span class="control-title">'+t.tooltip+"</span>"),e.attr("data-tooltip",t.tooltip)),this._attachUnpinClickListener(e),$("<li></li>").append(e)},_attachUnpinClickListener:function(t){var e=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(){e.hideTooltip(t),e.doTogglePin()})},_generateReload:function(){var t=this.$options.reload,e=$('<a data-func="reload"></a>');return e.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(e.append('<span class="control-title">'+t.tooltip+"</span>"),e.attr("data-tooltip",t.tooltip)),this._attachReloadClickListener(e),$("<li></li>").append(e)},_attachReloadClickListener:function(t){var e=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(){e.hideTooltip(t),e.load()})},_generateMinimize:function(){var t=this.$options.minimize,e=$('<a data-func="minimize"></a>');return e.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(e.append('<span class="control-title">'+t.tooltip+"</span>"),e.attr("data-tooltip",t.tooltip)),this._attachMinimizeClickListener(e),$("<li></li>").append(e)},_attachMinimizeClickListener:function(t){var e=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(i){i.stopPropagation(),e.hideTooltip(t),e.toggleMinimize()})},_generateExpand:function(){var t=this.$options.expand,e=$('<a data-func="expand"></a>');return e.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(e.append('<span class="control-title">'+t.tooltip+"</span>"),e.attr("data-tooltip",t.tooltip)),this._attachExpandClickListener(e),$("<li></li>").append(e)},_generateChangeStyle:function(){var t=this,e=t.$options.changeStyle,i=$('<a data-func="changeStyle"></a>');i.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+e.icon+'"></i>'),e.tooltip&&"string"==typeof e.tooltip&&(i.append('<span class="control-title">'+e.tooltip+"</span>"),i.attr("data-tooltip",e.tooltip));var n=$('<li class="style-change-item"></li>').append(i),a=$("<div>",{class:"style-list"}).appendTo(n);if(t.$options.styles)for(var o=0;o<t.$options.styles.length;o++){var l=t.$options.styles[o];a.append('<div class="style-item style-primary" style="background-color: '+l.bg+'" data-bg="'+l.bg+'" data-text="'+l.text+'"></div>')}return a.find(".style-item").on("click",function(){var e=$(this);t.saveParam("panelStyle",{bg:e.data("bg"),text:e.data("text")}),t.applyStyle(e.data("bg"),e.data("text")),a.removeClass("opened")}),i.on("click",function(){$(this).closest(".style-change-item").find(".style-list").toggleClass("opened")}),n},applyStyle:function(t,e){this.$heading.css("background-color",t),this.$heading.css("border-color",t),this.$heading.css("color",e),this.$el.css("border-color",t)},_createDropdownForStyleChange:function(){for(var t=this,e=$("<div>",{class:"dropdown"}).append($("<button>",{type:"button","data-toggle":"dropdown",class:"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-th"></i>'})),i=$("<div>",{class:"dropdown-menu dropdown-menu-right"}).appendTo(e),n=0;n<0;n++){t.$globalOptions.listStyles[n];$('<div class="primary"></div>').on("mousedown",function(t){t.stopPropagation()}).click(function(){for(var e=t.$el[0].className.split(" "),i=null,n=0;n<e.length;n++)t.$globalOptions.listStyles.indexOf(e[n])>-1&&(i=e[n]);t.$el.removeClass(t.$globalOptions.listStyles.join(" ")).addClass(this.className),t._triggerEvent("styleChange",[t,i,this.className])}).appendTo(i)}return e},_attachExpandClickListener:function(t){var e=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(i){i.stopPropagation(),e.hideTooltip(t),e.toggleSize()})},_generateClose:function(){var t=this.$options.close,e=$('<a data-func="close"></a>');return e.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(e.append('<span class="control-title">'+t.tooltip+"</span>"),e.attr("data-tooltip",t.tooltip)),this._attachCloseClickListener(e),$("<li></li>").append(e)},_attachCloseClickListener:function(t){var e=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(i){i.stopPropagation(),e.hideTooltip(t),e.close()})},_getMaxZIndex:function(){var t,e,i,n=$(".lobipanel.panel-unpin:not(.panel-minimized.panel-expanded)");if(0===n.length)return{id:"","z-index":LobiPanel.PRIVATE_OPTIONS.initialZIndex};t=$(n[0]).attr("style");var a=$(n[0]).data("inner-id");e=t?t.getCss()["z-index"]:LobiPanel.PRIVATE_OPTIONS.initialZIndex;for(var o=1;o<n.length;o++)(i=(t=$(n[o]).attr("style"))?t.getCss()["z-index"]:0)>e&&(a=$(n[o]).data("inner-id"),e=i);return{id:a,"z-index":parseInt(e,10)}},_onPanelClick:function(){var t=this;t.$el.on("mousedown.lobiPanel",function(){if(t.isPinned()||t.isMinimized()||t.isOnFullScreen())return!1;t.bringToFront()})},_offPanelClick:function(){this.$el.off("mousedown.lobiPanel")},_changeClassOfControl:function(t){t=$(t);var e=this.$options[t.attr("data-func")];e.icon&&t.find("."+LobiPanel.PRIVATE_OPTIONS.iconClass).toggleClass(e.icon).toggleClass(e.icon2)},_getFooterForMinimizedPanels:function(){var t=$("."+LobiPanel.PRIVATE_OPTIONS.toolbarClass);return 0===t.length&&(t=$('<div class="'+LobiPanel.PRIVATE_OPTIONS.toolbarClass+'"></div>'),$("body").append(t)),t},_expandOnHeaderClick:function(){var t=this;t.$heading.on("click.lobiPanel",function(){t.maximize(),t.bringToFront()})},_removeExpandOnHeaderClick:function(){this.$heading.off("click.lobiPanel")},_getAvailableWidth:function(t){return this.$options.maxWidth&&(t=Math.min(t,this.$options.maxWidth)),this.$options.minWidth&&(t=Math.max(t,this.$options.minWidth)),t},_getAvailableHeight:function(t){return this.$options.maxHeight&&(t=Math.min(t,this.$options.maxHeight)),this.$options.minHeight&&(t=Math.max(t,this.$options.minHeight)),t},_calculateBodyHeight:function(t){return t-this.$heading.outerHeight()-this.$el.find(".panel-footer").outerHeight()},_calculateBodyWidth:function(t){return t-2},_appendInnerIdToParent:function(t,e){if(void 0===t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr))t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,e);else{if(t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr).indexOf(e)>-1)return;var i=t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr);t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,i+" "+e)}this.$el.attr("data-index",this.$el.index())},_insertInParent:function(){var t=$("["+LobiPanel.PRIVATE_OPTIONS.parentAttr+"~="+this.innerId+"]");this.$el.insertAt(this.$el.attr("data-index"),t)},_generateWindow8Spinner:function(){var t=['<div class="spinner spinner-windows8">','<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>","</div>"].join("");return $('<div class="spinner-wrapper">'+t+"</div>")},_enableSorting:function(){var t=this,e=t.$el.parent();e.hasClass("ui-sortable")&&e.sortable("destroy"),t.$options.sortable?(t.$el.addClass("lobipanel-sortable"),e.addClass("lobipanel-parent-sortable")):t.$el.removeClass("lobipanel-sortable"),e.sortable({connectWith:".lobipanel-parent-sortable",items:".lobipanel-sortable",handle:".panel-heading",cursor:"move",placeholder:"lobipanel-placeholder",forcePlaceholderSize:!0,opacity:.7,revert:300,update:function(e,i){t.savepanelPositions();var n=i.item.data("inner-id");t._removeInnerIdFromParent(n),t._appendInnerIdToParent(i.item.parent(),n),t._triggerEvent("dragged")}})},savepanelPositions:function(){var t=this;$(".lobipanel-parent-sortable").each(function(e,i){var n=$(i),a=n.data("inner-id");if(a){var o={};n.find(".lobipanel").each(function(t,e){var i=$(e);o[i.data("inner-id")]=t}),t.storageObject.saveChildPositions(a,o)}else console.error("Panel does not have parent id ",n)})},_disableSorting:function(){var t=this.$el.parent();t.hasClass("ui-sortable")&&t.sortable("destroy")},_removeInnerIdFromParent:function(t){var e=$("["+LobiPanel.PRIVATE_OPTIONS.parentAttr+"~="+t+"]");if(e.length){var i=e.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr).replace(t,"").trim().replace(/\s{2,}/g," ");e.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,i)}},_onToggleIconsBtnClick:function(){var t=this;t.$heading.find(".toggle-controls").on("click.lobiPanel",function(){t.$el.toggleClass("controls-expanded")})},_adjustForScreenSize:function(){this.disableTooltips(),$(window).width()>768&&this.$options.tooltips&&this.enableTooltips(),this.isOnFullScreen()&&this.$body.css({width:this._calculateBodyWidth(this.$el.width()),height:this._calculateBodyHeight(this.$el.height())})},_enableResponsiveness:function(){var t=this;t._adjustForScreenSize(),$(window).on("resize.lobiPanel",function(){t._adjustForScreenSize()})},_setBodyHeight:function(){"auto"!==this.$options.bodyHeight&&this.$body.css({height:this.$options.bodyHeight,overflow:"auto"})},_getOptionsFromAttributes:function(){var me=this,$el=me.$el,options={};for(var key in $.fn.lobiPanel.DEFAULTS){var k=key.toDash(),val=$el.data(k);void 0!==val&&("object"!=typeof $.fn.lobiPanel.DEFAULTS[key]?options[key]=val:options[key]=eval("("+val+")"))}return options},_saveState:function(t,e){!this.hasRandomId&&this.$options.stateful&&(this.storage.state=t,e&&(this.storage.stateParams=e),this._saveLocalStorage(this.storage))},getParam:function(t,e){return this.storage[t]},saveParam:function(t,e){this.storage[t]=e,this._saveLocalStorage(this.storage)},_saveLocalStorage:function(t){this.storageObject.savePanelParams(this.innerId,t)},_applyState:function(t,e){switch(t){case"pinned":var i=this.storageObject.getAllPanelPositions();for(var n in i){var a=i[n],o=n,l=$(".lobipanel-parent-sortable[data-inner-id="+o+"]");for(var s in a){var r=$("[data-inner-id="+s+"]");this._removeInnerIdFromParent(r.data("inner-id")),this._appendInnerIdToParent(l,r.data("inner-id")),r.hasClass("panel-unpin")||r.hasClass("panel-expanded")||r.insertAt(a[s],l)}}break;case"unpinned":this.unpin(),this.setPosition(e.left,e.top,0),this.setSize(e.width,e.height,0);break;case"minimized":this.unpin(),this.minimize();break;case"collapsed":this.minimize();break;case"fullscreen":this.toFullScreen()}},_applyIndex:function(t){null!==t&&this.$el.insertAt(t,this.$el.parent())},_triggerEvent:function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift(this),this.$el.trigger(t+".lobiPanel",e),!this.$options[t]||"function"!=typeof this.$options[t]||this.$options[t].apply(this,e)},doPin:function(){return!1!==this._triggerEvent("beforePin")&&(this.pin(),this._saveState("pinned"),this._triggerEvent("onPin")),this},doUnpin:function(){return!1!==this._triggerEvent("beforeUnpin")&&(this.unpin(),this._updateUnpinnedState(),this._triggerEvent("onUnpin")),this},doTogglePin:function(){return this.isPinned()?this.doUnpin():this.doPin(),this},_updateUnpinnedState:function(){this._saveState("unpinned",this.getAlignment())},getAlignment:function(){return{top:this.$el.css("top"),left:this.$el.css("left"),width:this.$el.css("width"),height:this.$el.css("height")}}},$.fn.lobiPanel=function(t){var e=arguments,i=null;return this.each(function(){var n=$(this),a=n.data("lobiPanel"),o="object"==typeof t&&t;a||n.data("lobiPanel",a=new LobiPanel(n,o)),"string"==typeof t&&(e=Array.prototype.slice.call(e,1),i=a[t].apply(a,e))}),i},LobiPanel.PRIVATE_OPTIONS={parentAttr:"data-lobipanel-child-inner-id",toolbarClass:"lobipanel-minimized-toolbar",initialZIndex:1e4,iconClass:"panel-control-icon"},$.fn.lobiPanel.DEFAULTS={draggable:!0,sortable:!1,connectWith:".ui-sortable",resize:"both",minWidth:200,minHeight:100,maxWidth:1200,maxHeight:700,loadUrl:"",autoload:!0,bodyHeight:"auto",tooltips:!0,toggleIcon:"glyphicon glyphicon-cog",expandAnimation:100,collapseAnimation:100,state:"pinned",initialIndex:null,stateful:!1,constrain:"document",unpin:{icon:"glyphicon glyphicon-move",tooltip:"Unpin"},reload:{icon:"glyphicon glyphicon-refresh",tooltip:"Reload"},minimize:{icon:"glyphicon glyphicon-minus",icon2:"glyphicon glyphicon-plus",tooltip:"Minimize"},expand:{icon:"glyphicon glyphicon-resize-full",icon2:"glyphicon glyphicon-resize-small",tooltip:"Fullscreen"},changeStyle:{icon:"glyphicon glyphicon-th",tooltip:"Style"},close:{icon:"glyphicon glyphicon-remove",tooltip:"Close"},editTitle:{icon:"glyphicon glyphicon-pencil",icon2:"glyphicon glyphicon-floppy-disk",tooltip:"Edit title"},styles:[{bg:"#d9534f",text:"#FFF"},{bg:"#f0ad4e",text:"#FFF"},{bg:"#337ab7",text:"#FFF"},{bg:"#5bc0de",text:"#FFF"},{bg:"#4753e4",text:"#FFF"},{bg:"#9e4aea",text:"#FFF"}],storageObject:null,beforeTitleChange:null},$(".lobipanel").lobiPanel();var $parent=$(".lobipanel-parent-sortable");$parent.hasClass("ui-sortable")||$parent.sortable({connectWith:".lobipanel-parent-sortable",items:".lobipanel-sortable",handle:".panel-heading",cursor:"move",placeholder:"lobipanel-placeholder",forcePlaceholderSize:!0,opacity:.7,revert:300,update:function(t,e){console.log(e)}})});